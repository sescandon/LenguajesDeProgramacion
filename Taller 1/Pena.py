memory = ["CargarValor A,120", "CargarValor B,240", "Copiar A,C", "Restar C,B", "SaltarSiCero 10", "SaltarSiNeg 8", "Restar A,B", "Saltar 2", "Restar B,A", "Saltar 2", "Almacenar A,35", "Parar", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

def ProccessArithmeticUnit(action,reg1,reg2):
    if (action == "Sumar"):
        result = reg1 + reg2
        C = 1 if result == 0 else 0
        P = 1 if result > 0 else 0
        N = 1 if result < 0 else 0
        D = 1 if result > 32767 or result < -32768 else 0
        return result, reg2, C, P, N, D
    elif (action == "Restar"):
        result = reg1 - reg2
        C = 1 if result == 0 else 0
        P = 1 if result > 0 else 0
        N = 1 if result < 0 else 0
        D = 1 if result > 32767 or result < -32768 else 0
        return result, reg2, C, P, N, D
    elif (action == "Mult"):
        result = reg1 * reg2
        C = 1 if result == 0 else 0
        P = 1 if result > 0 else 0
        N = 1 if result < 0 else 0
        D = 1 if result > 32767 or result < -32768 else 0
        return result, reg2, C, P, N, D
    elif (action == "Div"):
        if reg2 == 0:
            raise ValueError("Division by zero")
        result = reg1 // reg2
        result2 = reg1 % reg2
        C = 1 if result == 0 else 0
        P = 1 if result > 0 else 0
        N = 1 if result < 0 else 0
        D = 1 if result > 32767 or result < -32768 else 0
        return result, result2 , C, P, N, D
    else:
        raise ValueError("Action not found")
    
def ProccessControlUnit(memory):
    A = [0]
    B = [0]
    C = [0]
    D = [0]

    def SetReg(Reg, value):
        Reg[0] = value
        return


    Cero = 0
    Positivo = 0
    Negativo = 0
    Desborde = 0

    prevCP = 0
    CP = 0
    IC = memory[CP: CP+16]
    while True:
        command = IC[CP]
        if command == "Parar":
            break
        command = command.split()
        instruction = command[0]
        parameters = command[1].split(",")

        if instruction == "Copiar":
            reg1 = locals()[parameters[0]][0]
            reg2 = locals()[parameters[1]]
            SetReg(reg2,reg1)

        elif instruction == "CargarValor":
            reg1 = locals()[parameters[0]]
            reg2 = int(parameters[1])
            SetReg(reg1,reg2)

        elif instruction == "Cargar":
            reg1 = locals()[parameters[0]]
            SetReg(reg1,memory[int(parameters[1])])

        elif instruction == "Almacenar":
            memory[int(parameters[1])] = locals()[parameters[0]][0]

        elif instruction == "SaltarSiCero":
            if(Cero == 1):
                CP = int(parameters[0])
                Cero = 0
                continue

        elif instruction == "SaltarSiPos":
            if(Positivo == 1):
                CP = int(parameters[0])
                Positivo = 0
                continue

        elif instruction == "SaltarSiNeg":
            if(Negativo == 1):
                CP = int(parameters[0])
                Negativo = 0
                continue

        elif instruction == "SaltarSiDes":
            if(Desborde == 1):
                CP = int(parameters[0])
                Desborde = 0
                continue

        elif instruction == "Saltar":
            CP = int(parameters[0])
            continue

    
        elif instruction == "Sumar" or instruction == "Restar" or instruction == "Mult" or instruction == "Div":
            result, reg2 , Cero, Positivo, Negativo, Desborde = ProccessArithmeticUnit(instruction, locals()[parameters[0]][0], locals()[parameters[1]][0])
            SetReg(locals()[parameters[0]], result)
            SetReg(locals()[parameters[1]], reg2)
        else:
            raise ValueError("Instruction not found", instruction)
            
        
        CP = CP + 1

    print(A)
    print(B)
    print(C)
    print(D)



ProccessControlUnit(memory)